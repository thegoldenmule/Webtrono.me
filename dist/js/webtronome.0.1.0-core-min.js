(function(a){a.AudioView=function(b){var c=this;var d=80;this._tick=null;this.load("audio/tick0");b.Ticked.add(function(){if(null===c._tick){return}c._tick.volume(d);c._tick.stop();c._tick.play()});$("#audio-volume").on("changed",function(e){var f=$("#audio-volume").slider("value");d=f/100;$("#audio-label").text(f)});$(".audio-button").click(function(j){c._tick=null;var f=j.target.attributes;for(var h=0,e=f.length;h<e;h++){var g=f[h].name;var k=f[h].value;if(g==="sound-name"){c.load(k);break}}})};a.AudioView.prototype={constructor:a.AudioView,load:function(b){this._tick=new Howl({urls:[b+".mp3",b+".ogg",b+".wav"]})}}})(this);(function(a){a.Easing={Linear:{None:function(b){return b}},Quadratic:{In:function(b){return b*b},Out:function(b){return b*(2-b)},InOut:function(b){if((b*=2)<1){return 0.5*b*b}return -0.5*(--b*(b-2)-1)}},Cubic:{In:function(b){return b*b*b},Out:function(b){return --b*b*b+1},InOut:function(b){if((b*=2)<1){return 0.5*b*b*b}return 0.5*((b-=2)*b*b+2)}},Quartic:{In:function(b){return b*b*b*b},Out:function(b){return 1-(--b*b*b*b)},InOut:function(b){if((b*=2)<1){return 0.5*b*b*b*b}return -0.5*((b-=2)*b*b*b-2)}},Quintic:{In:function(b){return b*b*b*b*b},Out:function(b){return --b*b*b*b*b+1},InOut:function(b){if((b*=2)<1){return 0.5*b*b*b*b*b}return 0.5*((b-=2)*b*b*b*b+2)}},Sinusoidal:{In:function(b){return 1-Math.cos(b*Math.PI/2)},Out:function(b){return Math.sin(b*Math.PI/2)},InOut:function(b){return 0.5*(1-Math.cos(Math.PI*b))}},Exponential:{In:function(b){return b===0?0:Math.pow(1024,b-1)},Out:function(b){return b===1?1:1-Math.pow(2,-10*b)},InOut:function(b){if(b===0){return 0}if(b===1){return 1}if((b*=2)<1){return 0.5*Math.pow(1024,b-1)}return 0.5*(-Math.pow(2,-10*(b-1))+2)}},Circular:{In:function(b){return 1-Math.sqrt(1-b*b)},Out:function(b){return Math.sqrt(1-(--b*b))},InOut:function(b){if((b*=2)<1){return -0.5*(Math.sqrt(1-b*b)-1)}return 0.5*(Math.sqrt(1-(b-=2)*b)+1)}},Elastic:{In:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}return -(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))},Out:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}return(b*Math.pow(2,-10*c)*Math.sin((c-d)*(2*Math.PI)/e)+1)},InOut:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}if((c*=2)<1){return -0.5*(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))}return b*Math.pow(2,-10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e)*0.5+1}},Back:{In:function(b){var c=1.70158;return b*b*((c+1)*b-c)},Out:function(b){var c=1.70158;return --b*b*((c+1)*b+c)+1},InOut:function(b){var c=1.70158*1.525;if((b*=2)<1){return 0.5*(b*b*((c+1)*b-c))}return 0.5*((b-=2)*b*((c+1)*b+c)+2)}},Bounce:{In:function(b){return 1-TWEEN.Easing.Bounce.Out(1-b)},Out:function(b){if(b<(1/2.75)){return 7.5625*b*b}else{if(b<(2/2.75)){return 7.5625*(b-=(1.5/2.75))*b+0.75}else{if(b<(2.5/2.75)){return 7.5625*(b-=(2.25/2.75))*b+0.9375}else{return 7.5625*(b-=(2.625/2.75))*b+0.984375}}}},InOut:function(b){if(b<0.5){return TWEEN.Easing.Bounce.In(b*2)*0.5}return TWEEN.Easing.Bounce.Out(b*2-1)*0.5+0.5}}}})(this);(function(a){a.Metronome=function(){this.bpm=120;this.Paused=new signals.Signal();this.Played=new signals.Signal();this.Ticked=new signals.Signal();this._playing=false;this._daemon=new Daemon.safe(this,this._tick,1);this._daemon.pause();this._lastTime=null};a.Metronome.prototype={constructor:a.Metronome,isPlaying:function(){return this._playing},play:function(){if(this._playing){return}this.Ticked.dispatch();this._lastTime=Date.now();this._daemon.play();this._playing=true;this.Played.dispatch()},pause:function(){if(!this._playing){return}this._daemon.pause();this._playing=false;this.Paused.dispatch()},_tick:function(){var b=(1000*60)/this.bpm;var c=Date.now();var d=c-this._lastTime;if(d>b){this._lastTime=c+d-b;this.Ticked.dispatch()}}}})(this);(function(a){a.PlaybackView=function(b){var c=this;this.metronome=b;$("#playback-toggle").click(function(){if(b.isPlaying()){b.pause()}else{b.play()}});$("#playback-up").click(function(){b.bpm+=1;c.updateBPM()});$("#playback-down").click(function(){b.bpm-=1;c.updateBPM()});b.Paused.add(function(){var d=$("#playback-toggle");if(d.hasClass("icon-pause")){d.removeClass("icon-pause")}if(!d.hasClass("icon-play")){d.addClass("icon-play")}});b.Played.add(function(){var d=$("#playback-toggle");if(d.hasClass("icon-play")){d.removeClass("icon-play")}if(!d.hasClass("icon-pause")){d.addClass("icon-pause")}});b.Ticked.add(function(){$("#playback-icon").toggleClass("icon-thermometer");setTimeout(function(){$("#playback-icon").toggleClass("icon-thermometer")},100);c.updateBPM()})};a.PlaybackView.prototype={constructor:a.PlaybackView,updateBPM:function(){$("#playback-bpm-label").text(Math.ceil(this.metronome.bpm).toString())}}})(this);(function(a){a.TimerCurveView=function(h,c){var n=this;var b=document.getElementById("timer-canvas-container");var f=new Raphael(b,"100%","100%");var d=b.offsetWidth;var l=b.offsetHeight;var i=f.rect(0,0,d,l);i.attr("fill","#CCCCCC");i.attr("stroke","#AAAAAA");i.attr("stroke-width",3);var g=f.path("m0,0l0,"+l);g.attr("stroke-width",5);g.attr("stroke","#DD1111");var e=f.path("M0,0"+l+"Q"+d/2+","+l+","+d+","+l);e.attr("stroke","#000000");var m=0;var k=0;var j=0;c.Started.add(function(){j=h.bpm;k=setInterval(function(){var p=c.getProgress();g.transform("T"+p*d+",0");var o=1-2*Math.abs(p-0.5);var q=j*m/100;h.bpm=j+o*q},1)});c.Stopped.add(function(){clearInterval(k)});$(".timer-curve-button").click(function(s){var p=s.target.attributes;for(var r=0,o=p.length;r<o;r++){var q=p[r].name;var t=p[r].value;if(q==="timer-value"){m=parseInt(t,10);if(0===m){e.remove();e=f.path("M0,0"+l+"Q"+d/2+","+l+","+d+","+l)}else{e.remove();e=f.path("M0,0"+l+"Q"+d/2+",-"+(m/50*40)+","+d+","+l)}break}}})};a.TimerCurveView.prototype={constructor:a.TimerCurveView}})(this);(function(b){function c(e){if(e<10){return"0"+e}return e}function d(e){if(e<10){return"00"+e}if(e<100){return"0"+e}return e}function a(e){var f=Math.floor(e/60000);e-=f*60000;var g=Math.floor(e/1000);e-=g*1000;return c(f)+":"+c(g)+":"+d(e)}b.TimerView=function(e){var f=this;this.Started=new signals.Signal();this.Stopped=new signals.Signal();this._metronome=e;$(".timer-button").click(function(m){var h=m.target.attributes;for(var l=0,g=h.length;l<g;l++){var j=h[l].name;var n=h[l].value;if(j==="timer-value"){var k=parseInt(n,10);if(0===k){f.stop()}else{f.start(k)}break}}});e.Paused.add(function(){f.pause()});e.Played.add(function(){f.resume()});this._startTime=null;this._pausedTime=null;this._totalTime=null;this._daemon=new Daemon.safe(this,this._tick,1);this._daemon.pause();this._timerBar=$("#timer-progress").progressbar()};b.TimerView.prototype={constructor:b.TimerView,getProgress:function(){if(null===this._startTime){return 0}if(null===this._pausedTime){return(Date.now()-this._startTime)/this._totalTime}return(this._pausedTime-this._startTime)/this._totalTime},start:function(e){this._pausedTime=null;this._startTime=Date.now();this._totalTime=e*60000;this._daemon.play();this._metronome.play();this.Started.dispatch()},pause:function(){if(null!==this._pausedTime){return}if(null===this._startTime){return}this._daemon.pause();this._pausedTime=Date.now()},resume:function(){if(null===this._pausedTime||null===this._startTime){return}var e=this._pausedTime-this._startTime;this._pausedTime=null;this._startTime=Date.now()-e;this._daemon.play()},stop:function(){this._daemon.pause();this._startTime=null;this._pausedTime=null;this._totalTime=null;this._tick();this.Stopped.dispatch()},_tick:function(){if(null===this._startTime){this._timerBar.progressbar("value",0);$("#timer-label").text("00:00:000")}else{var e=Date.now()-this._startTime;if(e>this._totalTime){this.stop()}else{this._timerBar.progressbar("value",e/this._totalTime*100);$("#timer-label").text(a(this._totalTime-e))}}}}})(this);(function(a){a.VisualizerView=function(b){var c="#FFFFFF";b.Ticked.add(function(){$("body").animate({backgroundColor:c},50,"swing",function(){$("body").animate({backgroundColor:"#ffffff"},100)})});$(".vs-button").click(function(d){c=$(d.target).css("background-color")})};a.VisualizerView.prototype={constructor:a.VisualizerView}})(this);(function(b){var a=function(){var f=this;this.metronome=new Metronome();var c=new PlaybackView(this.metronome);var h=new TimerView(this.metronome);var e=new TimerCurveView(this.metronome,h);var d=new VisualizerView(this.metronome);var g=new AudioView(this.metronome);return f};$(document).ready(a)})(this);